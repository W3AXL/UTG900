* UTG-900 - Tool to control UNIT-T UTG900 Waveform generator $Release:0.0.4-SNAPSHOT$

** Usage
:PROPERTIES:
:header-args:bash: :dir  UTG900
:END:

*** Interactive mode

Command

#+BEGIN_SRC bash :eval no :results output :exports both
./UTG900.py
#+END_SRC

starts UTG-900 - Tool in interactive mode, and prompts user with

#+begin_example
Command [q=quit,?=help] >
#+end_example

- Help, and list of commands is presented with ~?~.
- Giving ~q~ exits the program
- Entering command name to the propts ask for command parameters


*** Command ~?~

Running 

#+name: help
#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py ?
#+END_SRC

shows commad usage

#+RESULTS: help
#+begin_example
UTG900.py - 0.0.4-SNAPSHOT: Tool to control UNIT-T UTG900 Waveform generator

Usage: UTG900.py [options] [commands and parameters] 

Commands:
              q  : Exit
              Q  : Exit
              ?  : Usage help
           sine  : Generate sine -wave on channel 1|2
         square  : Generate square -wave on channel 1|2
          pulse  : Generate pulse -wave on channel 1|2
             on  : Switch on channel 1|2
            off  : Switch off channel 1|2
          reset  : Send reset to UTG900 signal generator
         screen  : Take screenshot to 'captureDir'
 list_resources  : List pyvisa resources (=pyvisa list_resources() wrapper)'
        version  : Output version number

More help:
  UTG900.py --help                          : to list options
  UTG900.py ? command=<command>             : to get help on command <command> parameters

Examples:
  UTG900.py ? command=sine                  : help on sine command parameters
  UTG900.py list_resources                  : Identify --addr option parameter
  UTG900.py --addr 'USB0::1::2::3::0::INSTR': Run interactively on device found in --addr 'USB0::1::2::3::0::INSTR'
  UTG900.py --captureDir=pics screen        : Take screenshot to pics directory (form device in default --addr)
  UTG900.py reset                           : Send reset to UTH900 waveform generator
  UTG900.py sine ch=2 freq=2kHz             : Generate 2 kHz sine signal on channel 2
  UTG900.py sine ch=1 square ch=2           : chaining sine generation on channel 1, and square generation on channel 2

Hint:
  One-liner in linux: UTG900.py --addr $(UTG900.py list_resources)
#+end_example


To list options run 

#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py --help
#+END_SRC

#+RESULTS:
#+begin_example

       USAGE: ./UTG900.py [flags]
flags:

./UTG900.py:
  --addr: UTG900 pyvisa resource address
    (default: 'USB0::0x6656::0x0834::1485061822::INSTR')
  --captureDir: Capture directory
    (default: 'tmp')
  --debug: -3=fatal, -1=warning, 0=info, 1=debug
    (default: '-1')
    (an integer)

Try --helpfull to get a list of all flags.
#+end_example


*** Command ~screen~ - take screenshot

Options of  ~screen~ -command

#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py ? command=screen
#+END_SRC

#+RESULTS:
: screen - Take screenshot to 'captureDir'
: 
:   fileName  : Screen capture file name (optional)
: 
: Notice:
: - parameters MUST BE given in the order listed above
: - parameters are optional and they MAY BE left out

For example, running command

#+BEGIN_SRC bash :eval no-export :results output :exports code
./UTG900.py --captureDir=pics screen fileName=example1.png
#+END_SRC

#+RESULTS:
: Successfully connected  'USB0::0x6656::0x0834::1485061822::INSTR' with 'UNI-T Technologies,UTG900,1485061822,1.08'

creates file ~example1.png~ in directory ~pics~. If ~fileName~
property is not given the command generates timestamped screenshot
file.

[[file:UTG900/pics/example1.png]]


*** Command ~reset~ - Send reset command to UTG900 

Options of  ~reset~ -command

#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py ? command=reset
#+END_SRC

#+RESULTS:
: reset - Send reset to UTG900 signal generator
: 
: *No parameters*
: 
: Notice:
: - parameters MUST BE given in the order listed above
: - parameters are optional and they MAY BE left out

Example usage:

#+BEGIN_SRC bash :eval no-export :results output :exports code
./UTG900.py reset
#+END_SRC

#+RESULTS:
: Successfully connected  'USB0::0x6656::0x0834::1485061822::INSTR' with 'UNI-T Technologies,UTG900,1485061822,1.08'


*** Command ~sine~ - Generate sive wave

Options of  ~sine~ -command

#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py ? command=sine
#+END_SRC

#+RESULTS:
#+begin_example
sine - Generate sine -wave on channel 1|2

        ch  : Channel 1,2 to switch on/off
      freq  : Frequency [uHz|mHz|kHz|MHz]
       amp  : Amplitude [mVpp|Vpp|mVrms|Vrms]
    offset  : Offset [mV|V]
     phase  : Phase [deg]

Notice:
- parameters MUST BE given in the order listed above
- parameters are optional and they MAY BE left out
#+end_example



For example, chaining of ~reset~, ~sine~, and ~screen~ commands. As the
result, the waveform generator generates 1 MHz sine signal on channel
1, with amplitude of 0.1V, offset of -0.5V, and phase of 42 degreees.
Finally, a screenshot is taken to file ~example-sine.png~.

#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py reset sine ch=1 freq=1MHz amp=100mVpp offset=-0.5V phase=42deg screen fileName=example-sine.png
#+END_SRC

#+RESULTS:
: Successfully connected  'USB0::0x6656::0x0834::1485061822::INSTR' with 'UNI-T Technologies,UTG900,1485061822,1.08'

The screenshot taken in the example above: 

[[file:UTG900/pics/example-sine.png]]


*** Command ~square~ - Generate square wave

Options of  ~square~ -command

#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py ? command=square
#+END_SRC

#+RESULTS:
#+begin_example
square - Generate square -wave on channel 1|2

        ch  : Channel 1,2 to switch on/off
      freq  : Frequency [uHz|mHz|kHz|MHz]
       amp  : Amplitude [mVpp|Vpp|mVrms|Vrms]
    offset  : Offset [mV|V]
     phase  : Phase [deg]
      duty  : Duty [%]

Notice:
- parameters MUST BE given in the order listed above
- parameters are optional and they MAY BE left out
#+end_example



*** Command ~pulse~ - Generate pulse wave

Options of  ~pulse~ -command

#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py ? command=pulse
#+END_SRC

#+RESULTS:
#+begin_example
pulse - Generate pulse -wave on channel 1|2

        ch  : Channel 1,2 to switch on/off
      freq  : Frequency [uHz|mHz|kHz|MHz]
       amp  : Amplitude [mVpp|Vpp|mVrms|Vrms]
    offset  : Offset [mV|V]
     phase  : Phase [deg]
      duty  : Duty [%]
    raised  : Raise [ns,us,ms,s,ks]
      fall  : Fall [ns,us,ms,s,ks]

Notice:
- parameters MUST BE given in the order listed above
- parameters are optional and they MAY BE left out
#+end_example



*** Command ~on~ and ~off~ - Switch channel on/off

Options of  ~on~ -command

#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py ? command=on
#+END_SRC

#+RESULTS:
: on - Switch on channel 1|2
: 
:         ch  : Channel 1,2 to switch on/off
: 
: Notice:
: - parameters MUST BE given in the order listed above
: - parameters are optional and they MAY BE left out


Options of  ~off~ -command

#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py ? command=off
#+END_SRC

#+RESULTS:
: off - Switch off channel 1|2
: 
:         ch  : Channel 1,2 to switch on/off
: 
: Notice:
: - parameters MUST BE given in the order listed above
: - parameters are optional and they MAY BE left out



*** Command ~list_resources~ - List pyvisa resourses

Command usage

#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py ? command=list_resources
#+END_SRC

#+RESULTS:
: list_resources - List pyvisa resources (=pyvisa list_resources() wrapper)'
: 
: *No parameters*
: 
: Notice:
: - parameters MUST BE given in the order listed above
: - parameters are optional and they MAY BE left out

Command ~list_resources~ 

#+name: list_resources
#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py list_resources
#+END_SRC

returns a list of devices, which pyvisa find. For example:

#+RESULTS: list_resources
: ('USB0::26198::2100::1485061822::0::INSTR',)


An empty list is returned, when no device is found.

#+BEGIN_SRC bash :eval no :results output :exports results
./UTG900.py list_resources
#+END_SRC

#+RESULTS:
: ()



*** Command ~version~ - Output version number

~version~ - command does not not take any parameters. It ouputs
version number of the tool

#+BEGIN_SRC bash :eval no-export :results output :exports both
./UTG900.py version
#+END_SRC

#+RESULTS:
: 0.0.4-SNAPSHOT


** Requirements 

Runs on python3 using ~absl-py~ and ~pyvisa-py~ packages. Screenshot
used ~convert~ -command from ~imagemagick~ tool.


* Install

** Create =setup.py= package

#+BEGIN_SRC bash :eval no-export :results output
cat VERSION
#+END_SRC

#+RESULTS:
: 0.0.3


Ref: https://packaging.python.org/guides/distributing-packages-using-setuptools/

#+BEGIN_SRC bash :eval no-export :results output :exports code
python3 setup.py  sdist  bdist_wheel
#+END_SRC

#+RESULTS:
#+begin_example
version 0.0.3 , packages ['UTG900']
running sdist
running egg_info
writing utg900.egg-info/PKG-INFO
writing dependency_links to utg900.egg-info/dependency_links.txt
writing top-level names to utg900.egg-info/top_level.txt
reading manifest file 'utg900.egg-info/SOURCES.txt'
writing manifest file 'utg900.egg-info/SOURCES.txt'
running check
creating utg900-0.0.3
creating utg900-0.0.3/UTG900
creating utg900-0.0.3/utg900.egg-info
copying files to utg900-0.0.3...
copying setup.py -> utg900-0.0.3
copying UTG900/UTG900.py -> utg900-0.0.3/UTG900
copying UTG900/__init__.py -> utg900-0.0.3/UTG900
copying UTG900/../RELEASES.md -> utg900-0.0.3/UTG900/..
copying UTG900/../VERSION -> utg900-0.0.3/UTG900/..
copying utg900.egg-info/PKG-INFO -> utg900-0.0.3/utg900.egg-info
copying utg900.egg-info/SOURCES.txt -> utg900-0.0.3/utg900.egg-info
copying utg900.egg-info/dependency_links.txt -> utg900-0.0.3/utg900.egg-info
copying utg900.egg-info/top_level.txt -> utg900-0.0.3/utg900.egg-info
Writing utg900-0.0.3/setup.cfg
Creating tar archive
removing 'utg900-0.0.3' (and everything under it)
running bdist_wheel
running build
running build_py
installing to build/bdist.linux-x86_64/wheel
running install
running install_lib
creating build/bdist.linux-x86_64/wheel
creating build/bdist.linux-x86_64/wheel/UTG900
copying build/lib/UTG900/__init__.py -> build/bdist.linux-x86_64/wheel/UTG900
copying build/lib/UTG900/UTG900.py -> build/bdist.linux-x86_64/wheel/UTG900
copying build/lib/VERSION -> build/bdist.linux-x86_64/wheel
copying build/lib/RELEASES.md -> build/bdist.linux-x86_64/wheel
running install_egg_info
Copying utg900.egg-info to build/bdist.linux-x86_64/wheel/utg900-0.0.3-py3.9.egg-info
running install_scripts
creating build/bdist.linux-x86_64/wheel/utg900-0.0.3.dist-info/WHEEL
creating 'dist/utg900-0.0.3-py3-none-any.whl' and adding 'build/bdist.linux-x86_64/wheel' to it
adding 'RELEASES.md'
adding 'VERSION'
adding 'UTG900/UTG900.py'
adding 'UTG900/__init__.py'
adding 'utg900-0.0.3.dist-info/METADATA'
adding 'utg900-0.0.3.dist-info/WHEEL'
adding 'utg900-0.0.3.dist-info/top_level.txt'
adding 'utg900-0.0.3.dist-info/RECORD'
removing build/bdist.linux-x86_64/wheel
#+end_example


** Install distribution package

#+BEGIN_SRC bash :eval no-export :results output
VERSION_FILE=$(ls -1tr dist/*.tar.gz | tail -1| cut -f2)
echo VERSION_FILE=$VERSION_FILE
python3 -m pip install --user $VERSION_FILE  && echo installed $VERSION_FILE
#+END_SRC

#+RESULTS:
#+begin_example
VERSION_FILE=dist/utg900-0.0.3.tar.gz
Processing ./dist/utg900-0.0.3.tar.gz
Building wheels for collected packages: utg900
  Building wheel for utg900 (setup.py): started
  Building wheel for utg900 (setup.py): finished with status 'done'
  Created wheel for utg900: filename=utg900-0.0.3-py3-none-any.whl size=6927 sha256=2119925b02a9cfffb7ed4766217aeaf9e25dedc5b6037ba563c008796da2ec9f
  Stored in directory: /home/jj/.cache/pip/wheels/4f/a5/ac/26a6b05bd6322efe5983535804c48cef89b17941d95806a5e2
Successfully built utg900
Installing collected packages: utg900
  Attempting uninstall: utg900
    Found existing installation: utg900 0.0.2
    Uninstalling utg900-0.0.2:
      Successfully uninstalled utg900-0.0.2
Successfully installed utg900-0.0.3
installed dist/utg900-0.0.3.tar.gz
#+end_example


 
* Fin                                                              :noexport:

** Emacs variables

   #+RESULTS:

   # Local Variables:
   # org-confirm-babel-evaluate: nil
   # End:
   #
   # Muuta 
   # eval: (cdlatex-mode)
   #
   # Local ebib:
   # org-ref-default-bibliography: "./README.bib"
   # org-ref-bibliography-notes: "./README-notes.org"
   # org-ref-pdf-directory: "./pdf/"
   # org-ref-notes-directory: "."
   # bibtex-completion-notes-path: "./README-notes.org"
   # ebib-preload-bib-files: ("./README.bib")
   # ebib-notes-file: ("./README-notes.org")
   # reftex-default-bibliography: ("./README.bib")



